# 6장 함수형 프로그래밍

함수형 프로그래밍이라는 개념은 프로그래밍 자체보다 앞서 등장했는데, 이 기반은 람다 계산법이다.
> 람다 계산법  
람다 대수(λ代數, 영어: lambda calculus) 또는 λ-대수 또는 람다 계산(λ計算) 또는 람다 계산법(λ計算法)은 추상화와 함수 적용 등의 논리 연산을 다루는 형식 체계이다.  
함수는 컴퓨터 과학과 수학의 기초를 이루는 개념이다. 람다 대수는 함수를 단순하게 표현할 수 있도록 하여 '함수의 계산'이라는 개념을 더 깊이 이해할 수 있게 돕는다.  
참고: [위키백과](https://ko.wikipedia.org/wiki/%EB%9E%8C%EB%8B%A4_%EB%8C%80%EC%88%98)

## 정수를 제곱하기

```java
// 25까지의 정수의 제곱을 출력하는 문제
public class Squint {
  public static void main(String args[]) {
    for (int i = 0; i < 25; i++) {
      System.out.println(i*i);
    }
  }
}
```

- 리스프에서 파생한 **클로저**라는 함수형 언어가 있는데, 클로저로 작성하면 

```clojure
(println (take 25 (map (fn [x] (* x x)) (range))))

;; (println ;___ 출력한다.
;;  (take 25 ;___ 처음부터 25까지
;;    (map (fn [x] (* x x)) ;__ 제곱을
;;      (range))))  ;___ 정수의
```

- 위와 같이 작성할 수 있다.
- println, take, map, range가 분명히 모두 함수
- 자바 프로그램은 가변 변수(Mutable variable)를 사용하는데, 가변 변수는 프로그램 실행 중에 상태가 변할 수 있다.
- 클로저 프로그램에서는 이러한 가변 변수가 전혀 없다.
- 함수형 언어에선 변수가 한 번 초기화 되면 절대로 변하지 않는다.

## 불변성과 아키텍쳐

- 아키텍처를 고려할 때 이러한 내용이 중요한 이유는 경합 조건, 교착상태 조건, 동시 업데이트 문제가 모두 가변 변수로 인해 발생하기 때문
- 만약 어떠한 변수도 갱신되지 않는다면 경합 조건이나 동시 업데이트 문제가 일어나지 않는다.
- 아키텍트라면 **동시성** 문제에 지대한 관심을 가져야 한다!
- 불변성이 정말로 가능한지를 스스로에게 반드시 물어봐!
- 타협을 해야한다.

## 가변성의 분리

- 불변성과 관련하여 가장 주요한 타협 중 하나는 가변 컴포넌트와 불변 컴포넌트로 분리하는 것이다.
- 불변 컴포넌트에서는 순수하게 함수형 방식으로만 작업이 처리되고, 어떤 가변 변수도 사용되지 않는다.
- 불변 컴포넌트는 변수의 상태를 변경할 수 있는, 즉 순수 함수형 컴포넌트가 아닌 하나 이상의 다른 컴포넌트와 서로 통신한다.

![image-6 1](https://user-images.githubusercontent.com/35620465/147490565-68ff4614-8540-4db5-866e-abe5bfade454.png)

- 핵심은, 애플리케이션을 제대로 구조화하려면 변수를 변경하는 컴포넌트와 변경하지 않는 컴포넌트를 분리해야 한다는 것이다.
- 현명한 아키텍트라면 가능한 많은 처리를 불변 컴포넌트에서 하고, 가변 컴포넌트에서는 코드를 줄여야 한다.

## 이벤트 소싱

- 저장 공간과 처리 능력의 한계는 급격히 희미해지고 있다.(램의 용량, 메모리가 수십억 바이트인 시대이니까) 그래서 가변 상태는 적어질 수 있다.
- 이벤트 소싱은 상태가 아닌 트랜잭션을 저장하자는 전략이다. 트랜잭션에는 가변 변수가 필요 없다.
- 상태가 필요해지면 단순히 상태의 시작점부터 모든 트랜잭션을 처리한다.
- 저장 공간과 처리 능력이 충분하면 애플리케이션이 완전한 불변성을 갖도록 만들 수 있고, 따라서 완전한 함수형으로 만들 수 있다.

## 결론

언급한 프로그래밍 패러다임을 요약하면
- 구조적 프로그래밍은 제어흐름의 직접적인 전환에 부과되는 규율이다.
- 객체 지향 프로그래밍은 제어흐름의 간접적인 전환에 부과되는 규율이다.
- 함수형 프로그래밍은 변수 할당에 부과되는 규율이다.
- 소프트웨어, 즉 컴퓨터 프로그램은 순차(sequence), 분기(selection), 반복(iteration), 참조(indirection)로 구성된다. 그 이상도 이하도 아니다.
